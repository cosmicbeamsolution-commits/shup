{"remainingRequest":"/var/www/geotiendas/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/var/www/geotiendas/app/src/views/ShopCreate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/var/www/geotiendas/app/src/views/ShopCreate.vue","mtime":1764593667360},{"path":"/var/www/geotiendas/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/geotiendas/app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/var/www/geotiendas/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/geotiendas/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCcKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJwppbXBvcnQgQ2FyZENvbXBvbmVudCBmcm9tICdAL2NvbXBvbmVudHMvQ2FyZENvbXBvbmVudCcKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdzaG9wX2NyZWF0ZScsCiAgY29tcG9uZW50czogewogICAgQ2FyZENvbXBvbmVudAogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKFsKICAgICAgJ2Jhc2ljJywKICAgICAgJ3Nob3AnCiAgICBdKQogIH0sCiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICBmb3JtOiB7CiAgICAgICAgc2hvcDogJycsCiAgICAgICAgY291bnRyeV9pc286ICcnLAogICAgICAgIGNvdW50cnk6ICcnCiAgICAgIH0sCiAgICAgIGFsbG93ZWRDb3VudHJpZXM6IFsnYXInXSwKICAgICAgY2xvY2s6IDAsCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHNob3BMb2FkaW5nOiBmYWxzZSwKICAgICAgY2hlY2tpbmdTdGF0dXM6IGZhbHNlLAogICAgICBzaG9wTmFtZVN0YXR1czoge30sCiAgICAgIGxhc3RJZDogbnVsbCwKICAgICAgc2hvcE5hbWVWYXJzOiB7CiAgICAgICAgbWluOiAzLAogICAgICAgIG1heDogMTYKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZCAoKSB7CiAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgIHRoaXMuJHJlZnMuYXV0b2ZvY3VzLmZvY3VzKCkKICAgIH0pCiAgICBpZiAodGhpcy5iYXNpYy5sb2NhbGUpIHsKICAgICAgdGhpcy5mb3JtLmNvdW50cnlfaXNvID0gdGhpcy5iYXNpYy5sb2NhbGUuY291bnRyeV9pc28KICAgICAgdGhpcy5mb3JtLmNvdW50cnkgPSB0aGlzLmJhc2ljLmxvY2FsZS5jb3VudHJ5CiAgICB9CiAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLm5hbWUpIHsKICAgICAgdGhpcy5mb3JtLnNob3AgPSB0aGlzLiRyb3V0ZS5wYXJhbXMubmFtZQogICAgICB0aGlzLmNoZWNrU2hvcFRpdGxlKCkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGNoZWNrU2hvcFRpdGxlICgpIHsKICAgICAgaWYgKHRoaXMuY2xvY2spIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMuY2xvY2spCiAgICAgIH0KICAgICAgdGhpcy5jbG9jayA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuZm9ybS5pZCA9IHRoaXMuZm9ybS5zaG9wLm5vcm1hbGl6ZSgnTkZLRCcpLnJlcGxhY2UoL1teXHddfF8vZywgJycpLnRvTG93ZXJDYXNlKCkKICAgICAgICB0aGlzLmNoZWNrc2hvcE5hbWVTdGF0dXMoKQogICAgICB9LCAxMDAwKQogICAgfSwKICAgIGNoZWNrc2hvcE5hbWVTdGF0dXMgKCkgewogICAgICBpZiAodGhpcy5sYXN0SWQgIT09IHRoaXMuZm9ybS5pZCkgewogICAgICAgIHRoaXMuc2hvcE5hbWVTdGF0dXMgPSB7fQogICAgICAgIHRoaXMuY2hlY2tpbmdTdGF0dXMgPSB0cnVlCiAgICAgICAgdGhpcy5sYXN0SWQgPSB0aGlzLmZvcm0uaWQKICAgICAgICBpZiAodGhpcy5mb3JtLmlkLmxlbmd0aCA8IHRoaXMuc2hvcE5hbWVWYXJzLm1pbiB8fCB0aGlzLmZvcm0uaWQubGVuZ3RoID4gdGhpcy5zaG9wTmFtZVZhcnMubWF4KSB7CiAgICAgICAgICB0aGlzLnNob3BOYW1lU3RhdHVzID0gewogICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLAogICAgICAgICAgICBtZXNzYWdlOiBgRWwgbm9tYnJlIGRlIGxhIGdlb3RpZW5kYSBkZWJlIHRlbmVyIGFsIG1lbm9zICR7dGhpcy5zaG9wTmFtZVZhcnMubWlufSB5IG3DoXhpbW8gJHt0aGlzLnNob3BOYW1lVmFycy5tYXh9IGNhcmFjdGVyZXMuICR7dGhpcy5mb3JtLmlkfSBjb250aWVuZSAke3RoaXMuZm9ybS5pZC5sZW5ndGh9YAogICAgICAgICAgfQogICAgICAgICAgdGhpcy5jaGVja2luZ1N0YXR1cyA9IGZhbHNlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF4aW9zLnBvc3QoJy9zaG9wcy9jaGVja25hbWUnLCB7IGlkOiB0aGlzLmZvcm0uaWQgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICB0aGlzLnNob3BOYW1lU3RhdHVzID0gcmVzLmRhdGEKICAgICAgICAgICAgdGhpcy5jaGVja2luZ1N0YXR1cyA9IGZhbHNlCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN1Ym1pdCAoKSB7CiAgICAgIGlmICghdGhpcy5hbGxvd2VkQ291bnRyaWVzLmluY2x1ZGVzKHRoaXMuZm9ybS5jb3VudHJ5X2lzbykpIHsKICAgICAgICByZXR1cm4gdGhpcy4kYnVlZnkudG9hc3Qub3Blbih7CiAgICAgICAgICBtZXNzYWdlOiBgTGFtZW50YWJsZW1lbnRlIHRvZGF2w61hIG5vIHRlbmVtb3MgcHJlc2VuY2lhIGVuIHR1IHBhw61zICR7dGhpcy5mb3JtLmNvdW50cnl9LiBUYWwgdmV6IGRlbnRybyBkZSBwb2NvLCBtYW50ZW50ZSBpbmZvcm1hZG8gYWNlcmNhIGRlIG51ZXN0cmFzIG5vdmVkYWRlcy5gLAogICAgICAgICAgZHVyYXRpb246IDE1MDAwCiAgICAgICAgfSkKICAgICAgfQogICAgICBpZiAodGhpcy5zaG9wTmFtZVN0YXR1cy5zdGF0dXMgIT09ICdzdWNjZXNzJykgewogICAgICAgIHRoaXMuc2hvcE5hbWVTdGF0dXMgPSB7fQogICAgICAgIHJldHVybiB0aGlzLiRidWVmeS50b2FzdC5vcGVuKHsKICAgICAgICAgIG1lc3NhZ2U6IGBSZXZpc8OhIGVsIHVzdWFyaW8gZGUgbGEgdGllbmRhIHkgdm9sdsOpIGEgaW50ZW50YXJgCiAgICAgICAgfSkKICAgICAgfQogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWUKICAgICAgYXhpb3MucG9zdChgL3Nob3BzL2NyZWF0ZWAsIHRoaXMuZm9ybSkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXMgPT09ICdzdWNjZXNzJykgewogICAgICAgICAgLy8gd2luZG93LmZicSgndHJhY2tDdXN0b20nLCAnc2hvcENyZWF0ZWQnLCB0aGlzLmZvcm0pCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2hvcCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuZm9ybSkpCiAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL3RpZW5kYS1jcmVhZGEnKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlCiAgICAgICAgICBsZXQgcGFydHMgPSByZXMuZGF0YS5tZXNzYWdlLnNwbGl0KCcuICcpCiAgICAgICAgICBwYXJ0cy5mb3JFYWNoKGUgPT4gewogICAgICAgICAgICB0aGlzLiRidWVmeS50b2FzdC5vcGVuKHsKICAgICAgICAgICAgICBtZXNzYWdlOiBlCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlCiAgICAgICAgdGhpcy4kYnVlZnkudG9hc3Qub3Blbih7CiAgICAgICAgICBtZXNzYWdlOiBgSHVibyB1biBlcnJvciBhbCBjcmVhciBsYSBnZW90aWVuZGEuIFBvciBmYXZvciwgaW50ZW50w6EgbnVldmFtZW50ZSBlbiB1bm9zIGluc3RhbnRlcy4gRXJyb3I6ICR7ZXJyfWAKICAgICAgICB9KQogICAgICB9KQogICAgfSwKICAgIGdvQmFjayAoKSB7CiAgICAgIHRoaXMuJHJvdXRlci5iYWNrKCkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["ShopCreate.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ShopCreate.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"animated fadeIn\">\n    <section class=\"hero is-top\">\n      <div class=\"content\">\n        <card-component :is-float=\"true\" :is-centered=\"true\">\n          <div v-show=\"!allowedCountries.includes(form.country_iso)\">\n            <h2>\n              <b-icon type=\"is-danger\" size=\"is-medium\" icon=\"map-marker-remove-variant\"/> <span class=\"has-text-danger\">Aún no disponible en {{ form.country }}</span>\n            </h2>\n            <p>Lamentamos informarte que todavía no tenemos presencia en {{ form.country }}. A través de nuestros servidores detectamos el origen geográfico de las solicitudes de tiendas. De esta manera solo permitimos que los solicitantes de países habilitados peudan registarse. Mantente informado a través de nuestro blog acerca de las últimas novedades para saber cuando llegaremos a tu país. Disculpas por las molestias ocasionadas.</p>\n            <div class=\"column has-text-centered\">\n              <img :src=\"`${$store.state.endpoint}/img/flags/${form.country_iso}.svg`\" width=\"160\"/>\n            </div>\n          </div>\n          <div v-show=\"allowedCountries.includes(form.country_iso)\">\n            <h2 class=\"has-text-weight-bold\">\n              Creá tu tienda\n            </h2>\n            <p>Completá este breve formulario y te enviaremos un correo con un enlace para que empieces a cargar y configurar tu tienda sin necesidad de iniciar sesión.</p>\n            <form class=\"form is-margin-top\" @submit.prevent=\"submit\">\n              <div class=\"columns\">\n                <div class=\"column\">\n                  <b-notification :type=\"'is-' + shopNameStatus.status + ' is-light'\" aria-close-label=\"Close notification\" v-show=\"shopNameStatus.message\">\n                    <span class=\"has-text-weight-bold\" v-html=\"shopNameStatus.message\"></span>\n                  </b-notification>\n                  <div class=\"control\">\n                    <b-field label=\"Nombre de tu marca\" expanded>\n                      <div class=\"control\" :class=\"{ 'is-loading': checkingStatus }\">\n                        <input v-model=\"form.shop\" ref=\"autofocus\" type=\"text\" class=\"input\" placeholder=\"Delicity\" @keyup=\"checkShopTitle\" :disabled=\"isLoading\" required />\n                      </div>\n                    </b-field>\n                  </div>\n                  <div class=\"control\">\n                    <b-field label=\"Tu email\" expanded>\n                      <b-input v-model=\"form.email\" type=\"email\" placeholder=\"juanmanuel@gmail.com\" :disabled=\"isLoading\" required />\n                    </b-field>\n                  </div>\n                  <div class=\"control\">\n                    <b-field label=\"Creá tu contraseña\" message=\"Creá una nueva contraseña exclusiva para geotiendas\" expanded>\n                      <b-input v-model=\"form.password\" type=\"password\" placeholder=\"********\" :disabled=\"isLoading\" password-reveal></b-input>\n                    </b-field>\n                  </div>\n                </div>\n                <div class=\"column is-hidden-mobile\">\n                  <div class=\"has-text-centered is-vpadded\">\n                    <img src=\"/img/art/team.svg\" width=\"320\"/>\n                  </div>\n                </div>\n              </div>\n              <div class=\"buttons is-flex-center\">\n                <b-button native-type=\"submit\" type=\"is-info\" :loading=\"isLoading\">\n                  <span v-show=\"!form.shop.length\" class=\"has-text-weight-bold\"> Crear mi tienda</span>\n                  <span v-show=\"form.shop.length\" class=\"has-text-weight-bold\"> Crear tienda <i>{{ form.shop }}</i></span>\n                </b-button>\n              </div>\n            </form>\n          </div>\n        </card-component>\n        <div class=\"buttons is-flex-center\">\n          <b-button icon-left=\"backspace\" @click=\"goBack()\">\n            <span class=\"\">Volver</span>\n          </b-button>\n          <a :href=\"$store.state.panel\" class=\"button\" target=\"_blank\">\n            <span class=\"has-text-weight-bold\">Ya tengo una tienda</span>\n          </a>\n          <a :href=\"$store.state.panel + '/olvide-contrasena'\" class=\"button\" target=\"_blank\">\n            <span class=\"has-text-weight-bold\">Olvidé mi contraseña</span>\n          </a>\n        </div>\n      </div>\n    </section>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport axios from 'axios'\nimport CardComponent from '@/components/CardComponent'\nexport default {\n  name: 'shop_create',\n  components: {\n    CardComponent\n  },\n  computed: {\n    ...mapState([\n      'basic',\n      'shop'\n    ])\n  },\n  data () {\n    return {\n      form: {\n        shop: '',\n        country_iso: '',\n        country: ''\n      },\n      allowedCountries: ['ar'],\n      clock: 0,\n      isLoading: false,\n      shopLoading: false,\n      checkingStatus: false,\n      shopNameStatus: {},\n      lastId: null,\n      shopNameVars: {\n        min: 3,\n        max: 16\n      }\n    }\n  },\n  created () {\n    this.$nextTick(() => {\n      this.$refs.autofocus.focus()\n    })\n    if (this.basic.locale) {\n      this.form.country_iso = this.basic.locale.country_iso\n      this.form.country = this.basic.locale.country\n    }\n    if (this.$route.params.name) {\n      this.form.shop = this.$route.params.name\n      this.checkShopTitle()\n    }\n  },\n  methods: {\n    checkShopTitle () {\n      if (this.clock) {\n        clearInterval(this.clock)\n      }\n      this.clock = setTimeout(() => {\n        this.form.id = this.form.shop.normalize('NFKD').replace(/[^\\w]|_/g, '').toLowerCase()\n        this.checkshopNameStatus()\n      }, 1000)\n    },\n    checkshopNameStatus () {\n      if (this.lastId !== this.form.id) {\n        this.shopNameStatus = {}\n        this.checkingStatus = true\n        this.lastId = this.form.id\n        if (this.form.id.length < this.shopNameVars.min || this.form.id.length > this.shopNameVars.max) {\n          this.shopNameStatus = {\n            status: 'danger',\n            message: `El nombre de la geotienda debe tener al menos ${this.shopNameVars.min} y máximo ${this.shopNameVars.max} caracteres. ${this.form.id} contiene ${this.form.id.length}`\n          }\n          this.checkingStatus = false\n        } else {\n          axios.post('/shops/checkname', { id: this.form.id }).then(res => {\n            this.shopNameStatus = res.data\n            this.checkingStatus = false\n          })\n        }\n      }\n    },\n    submit () {\n      if (!this.allowedCountries.includes(this.form.country_iso)) {\n        return this.$buefy.toast.open({\n          message: `Lamentablemente todavía no tenemos presencia en tu país ${this.form.country}. Tal vez dentro de poco, mantente informado acerca de nuestras novedades.`,\n          duration: 15000\n        })\n      }\n      if (this.shopNameStatus.status !== 'success') {\n        this.shopNameStatus = {}\n        return this.$buefy.toast.open({\n          message: `Revisá el usuario de la tienda y volvé a intentar`\n        })\n      }\n      this.isLoading = true\n      axios.post(`/shops/create`, this.form).then(res => {\n        if (res.data.status === 'success') {\n          // window.fbq('trackCustom', 'shopCreated', this.form)\n          localStorage.setItem('shop', JSON.stringify(this.form))\n          this.$router.push('/tienda-creada')\n        } else {\n          this.isLoading = false\n          let parts = res.data.message.split('. ')\n          parts.forEach(e => {\n            this.$buefy.toast.open({\n              message: e\n            })\n          })\n        }\n      }).catch(err => {\n        this.isLoading = false\n        this.$buefy.toast.open({\n          message: `Hubo un error al crear la geotienda. Por favor, intentá nuevamente en unos instantes. Error: ${err}`\n        })\n      })\n    },\n    goBack () {\n      this.$router.back()\n    }\n  }\n}\n</script>\n"]}]}