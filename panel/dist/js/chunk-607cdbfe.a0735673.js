(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-607cdbfe"],{"471d":function(t,e,a){},db1d:function(t,e,a){"use strict";var i=a("471d"),o=a.n(i);o.a},edb0:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("sale-box",{attrs:{"is-active":t.isModalActive,"data-item":t.item},on:{confirm:t.trashConfirm,cancel:t.trashCancel}}),a("nav-bar"),a("aside-menu"),a("hero-bar",[a("b-icon",{attrs:{icon:"map-marker-multiple-outline",size:"is-medium"}}),t._v(" Entregas "),a("div",{staticClass:"buttons",attrs:{slot:"right"},slot:"right"},[a("a",{staticClass:"button ",on:{click:t.getData}},[a("span",[t._v("Actualizar")])]),a("a",{staticClass:"button ",on:{click:t.print}},[a("span",[t._v("Imprimir")])])])],1),a("section",{staticClass:"section is-main-section"},[a("div",{staticClass:"columns"},t._l(t.data,(function(e,i){return a("div",{key:i,staticClass:"column is-clickable",on:{click:function(e){return t.showPartial(i)}}},[a("card-widget",{staticClass:"tile is-child is-clickable",class:{"is-active":t.activeIndex===i},attrs:{type:"is-light",icon:"map-marker-multiple-outline",number:e.total_deliveries,label:e.formatted_date}})],1)})),0),Object.keys(t.partial).length?a("card-component",[a("div",{attrs:{id:"map"}})]):a("notification",{staticClass:"is-info"},[a("p",[t._v("No hay pedidos activos por el momento")])])],1)],1)},o=[],s=(a("a4d3"),a("e01a"),a("99af"),a("4160"),a("a15b"),a("d81d"),a("13d5"),a("fb6a"),a("b64b"),a("d3b7"),a("159b"),a("bc3a")),n=a.n(s),r=a("c1df"),c=a.n(r),d=a("d000"),l=a("25f7"),u=a("6df7"),p=a("503b"),f=a("9981"),m=a("7f57"),h=a("e192"),v=a.n(h),g=a("2b9d"),b={name:"Delivery",components:{NavBar:d["a"],AsideMenu:l["a"],HeroBar:p["a"],SaleBox:f["a"],CardWidget:m["a"],CardComponent:u["a"],Notification:g["a"]},data:function(){return{isModalActive:!1,activeIndex:0,map:null,item:{},data:[],partial:[],features:[],coordinates:[]}},sockets:{sale:function(t){this.getData()}},created:function(){var t=this,e=this;this.getData(),window.set_delivery_code=function(a){var i=document.getElementById(a);if(i){var o=i.value.toUpperCase();e.updateItem(a,{delivery_code:o}).then((function(e){t.features.map((function(t){return t.properties._id===a&&(t.properties.title=["#"+e.id,i.value].join(" - "),t.properties.description=['<h6 class="subtitle has-text-weight-bold is-marginless">Código de Entrega</h6>',"<p>Zona y prioridad ej. A1, C5, etc</p>",'<div class="field has-addons"><div class="control"><input class="input" type="text" id="'.concat(a,'" value="').concat(o,'"></div><div class="control"><input class="button is-info" type="button" onclick="set_delivery_code(\'').concat(a,'\')" value="OK"></div></div>')].join("")),t}));var s={type:"FeatureCollection",features:t.features};t.map.getSource("markers").setData(s);var n=document.getElementsByClassName("mapboxgl-popup");n.length&&n[0].remove(),t.$buefy.toast.open({message:"Zona de Entrega actualizada"})}))}}},computed:{titleStack:function(){return["Gestor","Entregas"]}},methods:{updateItem:function(t,e){return new Promise((function(a,i){n.a.post("/sales/".concat(t),e).then((function(t){a(t.data)}))}))},showPartial:function(t){var e=this;this.activeIndex=t,this.partial=this.data[t],setTimeout((function(){e.drawMap()}),700)},print:function(t){window.print()},showItem:function(t){this.item=t,this.isModalActive=!0},getData:function(){var t=this;this.$store.dispatch("loaded",!1),n.a.post("/sales/sort",{find:{},sort:{created:1}}).then((function(e){if(t.data=[],e.data.length){var a=t.$root.groupBy(e.data,"delivery_date");Object.keys(a).forEach((function(e){var i=a[e];t.data.push({date:e,formatted_date:c()(e).format("DMMM YYYY").toUpperCase(),sales:i,total_deliveries:i.length})})),t.showPartial(t.data.length-1)}t.$store.dispatch("loaded",!0)}))},drawMap:function(){v.a.accessToken=this.$root.accessToken;var t=new v.a.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[this.partial.sales[0].customer.geo.lng,this.partial.sales[0].customer.geo.lat],zoom:14}),e=[],a=[];this.partial.sales.forEach((function(t){if(t.customer&&t.customer.geo&&t.customer.geo.lng&&t.customer.geo.lat){var i=[t.customer.geo.lng,t.customer.geo.lat];a.push(i);var o=t.delivery_code||"?";e.push({type:"Feature",properties:{_id:t._id,title:["#"+t.id,t.delivery_code].join(" - "),description:['<h6 class="subtitle has-text-weight-bold is-marginless">Código de Entrega</h6>',"<p>Zona y prioridad ej. A1, C5, etc</p>",'<div class="field has-addons"><div class="control"><input class="input" type="text" id="'.concat(t._id,'" value="').concat(o,'"></div><div class="control"><input class="button is-info" type="button" onclick="set_delivery_code(\'').concat(t._id,'\')" value="OK"></div></div>')].join(""),icon:"custom-marker"},geometry:{type:"Point",coordinates:i}})}})),t.on("load",(function(){t.loadImage("/img/custom_marker.png",(function(a,i){if(a)throw a;t.addImage("custom-marker",i),t.addSource("markers",{type:"geojson",data:{type:"FeatureCollection",features:e}}),t.addLayer({id:"points",type:"symbol",source:"markers",layout:{"icon-image":"custom-marker","icon-size":1,"text-field":["get","title"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,.25],"text-anchor":"top"}})})),t.on("click","points",(function(e){var a=e.features[0].geometry.coordinates.slice(),i=e.features[0].properties.description,o=e.features[0].properties._id;while(Math.abs(e.lngLat.lng-a[0])>180)a[0]+=e.lngLat.lng>a[0]?360:-360;(new v.a.Popup).setLngLat(a).setHTML(i).addTo(t),setTimeout((function(){document.getElementById(o).select()}),100)})),t.on("mouseenter","points",(function(){t.getCanvas().style.cursor="pointer"})),t.on("mouseleave","points",(function(){t.getCanvas().style.cursor=""}));var i=a.reduce((function(t,e){return t.extend(e)}),new v.a.LngLatBounds(a[0],a[0]));a.length>1&&t.fitBounds(i,{padding:100,offset:[0,0]})})),this.features=e,this.map=t},trashModal:function(t){this.trashObject=t,this.isModalActive=!0},trashConfirm:function(){var t=this;this.isLoading=!0,this.isModalActive=!1,n.a.post(["upload","delete"].join("/"),{files:[this.trashObject.src]}).then((function(e){t.isLoading=!1,t.$emit("fileDeleted",e.data)}))},trashCancel:function(){this.isModalActive=!1}}},y=b,C=(a("db1d"),a("2877")),_=Object(C["a"])(y,i,o,!1,null,null,null);e["default"]=_.exports},fb6a:function(t,e,a){"use strict";var i=a("23e7"),o=a("861d"),s=a("e8b5"),n=a("23cb"),r=a("50c4"),c=a("fc6a"),d=a("8418"),l=a("b622"),u=a("1dde"),p=a("ae40"),f=u("slice"),m=p("slice",{ACCESSORS:!0,0:0,1:2}),h=l("species"),v=[].slice,g=Math.max;i({target:"Array",proto:!0,forced:!f||!m},{slice:function(t,e){var a,i,l,u=c(this),p=r(u.length),f=n(t,p),m=n(void 0===e?p:e,p);if(s(u)&&(a=u.constructor,"function"!=typeof a||a!==Array&&!s(a.prototype)?o(a)&&(a=a[h],null===a&&(a=void 0)):a=void 0,a===Array||void 0===a))return v.call(u,f,m);for(i=new(void 0===a?Array:a)(g(m-f,0)),l=0;f<m;f++,l++)f in u&&d(i,l,u[f]);return i.length=l,i}})}}]);
//# sourceMappingURL=chunk-607cdbfe.a0735673.js.map