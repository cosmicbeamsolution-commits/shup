(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49f5e7d0"],{"7e12":function(t,e,a){var s=a("da84"),i=a("58a8").trim,n=a("5899"),o=s.parseFloat,c=1/o(n+"-0")!==-1/0;t.exports=c?function(t){var e=i(String(t)),a=o(e);return 0===a&&"-"==e.charAt(0)?-0:a}:o},acd8:function(t,e,a){var s=a("23e7"),i=a("7e12");s({global:!0,forced:parseFloat!=i},{parseFloat:i})},af7c:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("sale-box",{attrs:{"is-active":t.isSaleBoxActive,"data-item":t.item},on:{update:t.saleUpdate,cancel:t.saleCancel}}),a("sale-delivery-box",{attrs:{"is-active":t.isSaleDeliveryBoxActive,"data-item":t.item},on:{update:t.saleDeliveryUpdate,cancel:t.saleDeliveryCancel}}),a("nav-bar"),a("aside-menu"),a("hero-bar",[a("b-icon",{attrs:{icon:"cash-usd",size:"is-medium"}}),t._v(" Ventas "),t.partial.sales?a("div",{staticClass:"buttons",attrs:{slot:"right"},slot:"right"},[a("a",{staticClass:"button ",on:{click:t.getData}},[a("span",[t._v("Actualizar")])]),a("a",{staticClass:"button ",on:{click:t.print}},[a("span",[t._v("Imprimir")])])]):t._e()],1),a("section",{staticClass:"section is-main-section"},[a("div",{staticClass:"columns"},t._l(t.data,(function(e,s){return a("div",{key:"statsKeys"+s,staticClass:"column is-clickable",on:{click:function(e){return t.showPartial(s)}}},[a("card-widget",{staticClass:"tile is-child is-clickable",class:{"is-active":t.activeIndex===s},style:t.activeIndex===s&&e.ratio_complete?"background: linear-gradient(to right,#02b875cc "+e.ratio_complete+"%,#02b875 "+e.ratio_complete+"%)":"",attrs:{type:"is-light",icon:"cash-usd",prefix:"$",number:e.total_complete,label:e.formatted_date+" $("+e.total+")"}})],1)})),0),t.partial.sales?a("card-component",[a("b-table",{staticClass:"items-table",attrs:{data:t.partial.sales,"default-sort-direction":"desc","default-sort":"id","detail-key":"id","opened-detailed":t.defaultOpenedDetails,"row-class":t.onRowClass,detailed:"",focusable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"id",label:"#",width:"40",sortable:"",numeric:"",searchable:""}},[a("a",{staticClass:"tag",class:{"is-info":!e.row.cancelled,"is-light":e.row.cancelled},attrs:{title:"Ver venta"},on:{click:function(a){return t.showItem(e.row)}}},[a("b-icon",{attrs:{icon:"toy-brick",type:"is-white",size:"is-small"}}),t._v(" "),a("span",{staticClass:"has-text-weight-bold"},[t._v(" "+t._s(e.row.id))])],1)]),a("b-table-column",{attrs:{field:"created",label:"Solicitado",sortable:"",searchable:""}},[a("span",{staticClass:"tag has-text-weight-bold is-uppercase",class:{"is-info":!e.row.cancelled,"is-light":e.row.cancelled}},[t._v(t._s(t._f("adjustShortTZ")(e.row.created)))])]),a("b-table-column",{attrs:{field:"customer.fullname",label:"Cliente",sortable:"",searchable:""}},[a("span",{staticClass:"is-capitalized"},[t._v(t._s(e.row.customer.fullname))])]),a("b-table-column",{attrs:{field:"total",label:"Total",sortable:"",numeric:"",searchable:""}},["cash"===e.row.payment_mode?a("span",{staticClass:"tag is-grey has-text-weight-bold"},[t._v("EFECT")]):t._e(),"bank"===e.row.payment_mode?a("span",{staticClass:"tag is-grey has-text-weight-bold"},[t._v("Banco")]):t._e(),"mercadopago"===e.row.payment_mode?a("span",{staticClass:"tag is-grey has-text-weight-bold"},[t._v("MERCADOPAGO")]):t._e(),a("span",{staticClass:"has-text-weight-bold has-text-grey"},[t._v(" $"+t._s(e.row.total))])]),a("b-table-column",{staticClass:"is-actions-cell",attrs:{label:"Cobrado",numeric:""}},[a("div",{staticClass:"buttons is-right"},[a("b-switch",{attrs:{disabled:e.row.cancelled||"mercadopago"===e.row.payment_mode&&e.row.payment_complete},on:{input:function(a){return t.togglePaymentComplete(e.row)}},model:{value:e.row.payment_complete,callback:function(a){t.$set(e.row,"payment_complete",a)},expression:"props.row.payment_complete"}})],1)])]}},{key:"detail",fn:function(e){return[a("div",{staticClass:"columns"},[a("div",{staticClass:"column"},[a("table",{staticClass:"table is-striped is-narrow is-bordered"},[a("tr",[a("td",{attrs:{width:"1%"}},[a("span",{staticClass:"has-text-grey"},[a("b-icon",{attrs:{icon:"account"}})],1)]),a("td",[a("span",{staticClass:"has-text-weight-bold"},[t._v(t._s(e.row.customer.fullname))])])]),a("tr",[a("td",{attrs:{width:"1%"}},[a("span",{staticClass:"has-text-grey has-text-weight-bold"},[a("b-icon",{attrs:{icon:"cellphone"}})],1)]),a("td",[a("a",{attrs:{href:"call:"+e.row.customer.phone,target:"_blank"}},[a("span",{staticClass:"has-text-weight-bold"},[t._v(t._s(e.row.customer.phone))])])])]),a("tr",[a("td",{attrs:{width:"1%"}},[a("span",{staticClass:"has-text-grey has-text-weight-bold"},[a("b-icon",{attrs:{icon:"email"}})],1)]),a("td",[a("a",{attrs:{href:"mailto:"+e.row.customer.email,target:"_blank"}},[a("span",{staticClass:"has-text-weight-bold"},[t._v(t._s(e.row.customer.email))])])])]),a("tr",[a("td",{attrs:{width:"1%"}},[a("span",{staticClass:"has-text-grey has-text-weight-bold"},[a("b-icon",{attrs:{icon:"select-marker"}})],1)]),a("td",[a("span",{staticClass:"has-text-weight-bold"},[t._v(t._s(e.row.customer.address))])])]),a("tr",[a("td",{attrs:{width:"1%"}},[a("span",{staticClass:"has-text-grey has-text-weight-bold"},[a("b-icon",{attrs:{icon:"comment"}})],1)]),a("td",[a("span",{staticClass:"has-text-weight-bold"},[t._v(t._s(e.row.customer.comments))])])])])]),a("div",{staticClass:"column"},[a("table",{staticClass:"table is-striped is-narrow"},t._l(e.row.items_sorted,(function(e,s){return a("tr",{key:s},[a("td",{attrs:{width:"1%"}},[a("span",{style:{color:e[0].color}},[t._v(t._s(e.length))])]),a("td",[a("span",{style:{color:e[0].color}},[t._v(t._s(s))])])])})),0)])])]}}],null,!1,173403560)})],1):a("div",{staticClass:"has-text-centered is-vpadded-x3 content"},[a("img",{attrs:{src:"/img/art/team-success.svg",width:"320"}}),a("h3",[t._v("Sin ventas, pero solo por ahora!")]),a("p",[t._v("Cuando tu tienda registre su primera venta aparecerá acá. "),a("br"),t._v("Podés consultar nuestra Guía y conocer más acerca de "),a("a",{attrs:{href:"https://overlemon.com/guia/tu-primera-venta"}},[t._v("Cómo concretar tu primera venta")])])])],1)],1)},i=[],n=(a("a4d3"),a("4de4"),a("c740"),a("4160"),a("a15b"),a("d81d"),a("13d5"),a("e439"),a("dbb4"),a("b64b"),a("d3b7"),a("acd8"),a("e25e"),a("159b"),a("ade3")),o=a("2f62"),c=a("bc3a"),r=a.n(c),l=a("c1df"),d=a.n(l),u=a("d000"),p=a("25f7"),m=a("6df7"),h=a("503b"),v=a("9981"),f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{active:t.isModalActive,"has-modal-card":""},on:{"update:active":function(e){t.isModalActive=e}}},[Object.keys(t.dataItem).length?a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("div",{staticClass:"modal-card-title"},[a("div",{staticClass:"level"},[a("div",{staticClass:"level-item level-left"},[a("span",{staticClass:"tag is-primary is-large has-text-weight-bold"},[t._v("#"+t._s(t.dataItem.id))])]),a("div",{staticClass:"level-item"},[a("span",{staticClass:"tag is-danger is-large has-text-weight-bold"},[t._v(t._s(t.dataItem.delivery_code||"?"))])]),a("div",{staticClass:"level-item level-right"},[a("span",{staticClass:"tag is-light is-large has-text-weight-bold has-text-grey is-uppercase"},[t._v(t._s(t._f("adjustShortTZ")(t.dataItem.created)))])])])])]),a("section",{staticClass:"modal-card-body"},[a("notification",{directives:[{name:"show",rawName:"v-show",value:t.dataItem.cancelled,expression:"dataItem.cancelled"}],staticClass:"is-info"},[a("div",[a("span",[t._v("Esta venta está cancelada")])])]),a("b-field",{attrs:{label:"Código de entrega",message:"Establece la zona y propridad de entrega. Ej: C1, B2, ..."}},[a("b-input",{ref:"delivery_code",attrs:{placeholder:"C1",autofocus:""},on:{keyup:t.onlyUpperCase},model:{value:t.dataItem.delivery_code,callback:function(e){t.$set(t.dataItem,"delivery_code",e)},expression:"dataItem.delivery_code"}})],1),a("div",{attrs:{id:"marker"}})],1),a("footer",{staticClass:"modal-card-foot is-flex-end"},[a("button",{staticClass:"button ",attrs:{type:"button"},on:{click:t.cancel}},[t._v("Cerrar")]),a("button",{directives:[{name:"show",rawName:"v-show",value:!t.dataItem.cancelled,expression:"!dataItem.cancelled"}],staticClass:"button is-success",attrs:{type:"button"},on:{click:t.confirm}},[t._v("Actualizar")]),a("button",{directives:[{name:"show",rawName:"v-show",value:t.dataItem.cancelled,expression:"dataItem.cancelled"}],staticClass:"button is-info",attrs:{type:"button"},on:{click:t.unconfirm}},[t._v("Restaurar venta")])])]):t._e()])},b=[],g=a("2b9d"),w=a("e192"),y=a.n(w),_={name:"SaleDeliveryBox",components:{Notification:g["a"]},props:{isActive:{type:Boolean,default:!1},dataItem:{type:Object,default:function(){}},trashObjectName:{type:String,default:null}},data:function(){return{isModalActive:!1}},computed:{order:function(){return this.$root.groupBy(this.dataItem.order,"name")}},methods:{onlyUpperCase:function(){this.dataItem.delivery_code=this.dataItem.delivery_code.toUpperCase()},cancel:function(){this.$emit("cancel")},confirm:function(){this.$emit("update",{item:this.dataItem,update:{delivery_code:this.dataItem.delivery_code}})},unconfirm:function(){this.$emit("update",{item:this.dataItem,update:{cancelled:!1}})},drawMap:function(){y.a.accessToken=this.$root.accessToken;var t=[this.dataItem.customer.geo.lng,this.dataItem.customer.geo.lat],e=new y.a.Map({container:"marker",style:"mapbox://styles/mapbox/streets-v11",center:t,zoom:14});(new y.a.Marker).setLngLat(t).addTo(e),this.mapLoaded=!0}},watch:{isActive:function(t){this.isModalActive=t},isModalActive:function(t){var e=this;t?(setTimeout((function(){e.$refs.delivery_code.focus()}),100),setTimeout((function(){e.drawMap()}),250)):this.cancel()}}},x=_,C=(a("b6bb"),a("2877")),I=Object(C["a"])(x,f,b,!1,null,null,null),k=I.exports,O=a("7f57");function A(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function j(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?A(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):A(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var S={name:"Sales",components:{NavBar:u["a"],AsideMenu:p["a"],HeroBar:h["a"],SaleBox:v["a"],CardComponent:m["a"],CardWidget:O["a"],SaleDeliveryBox:k},data:function(){return{isSaleBoxActive:!1,isSaleDeliveryBoxActive:!1,defaultOpenedDetails:[],activeIndex:0,query:"",item:{},data:[],partial:[]}},sockets:{sale:function(t){this.getData()}},created:function(){this.$store.dispatch("mark",{sales:!1}),this.getData()},computed:j({},Object(o["b"])(["basic","shop"])),methods:{onRowClass:function(t,e){var a=[];return t.hidden&&a.push("is-hidden"),t.cancelled&&a.push("is-cancelled"),a.join(" ")},showPartial:function(t){this.activeIndex=t,this.partial=this.data[t]},getData:function(){var t=this;this.$store.dispatch("loaded",!1),r.a.post("/sales/sort",{find:{shop:this.shop._id},sort:{created:1}}).then((function(e){if(e.data.length){t.data=[],e.data.map((function(t){return t.date_group=d()(t.created).format("YYYY-MM"),t}));var a=t.$root.groupBy(e.data,"date_group");Object.keys(a).forEach((function(e){var s=a[e],i=s.filter((function(t){return t.payment_complete&&!t.cancelled})).reduce((function(t,e){return t+parseFloat(e.total)}),0),n=s.filter((function(t){return!t.cancelled})).reduce((function(t,e){return t+parseFloat(e.total)}),0);s.map((function(e){return e.items_sorted=t.$root.groupBy(e.order,"name"),e})),t.data.push({date:e,formatted_date:d()(e).format("MMM YYYY").toUpperCase(),sales:s.reverse(),total:n,total_complete:i,ratio_complete:parseInt(i/n*100)}),t["statsKeys"+t.data.length-1]=0})),t.showPartial(t.data.length-1)}t.$store.dispatch("loaded",!0)}))},togglePaymentComplete:function(t){var e=this,a={payment_complete:t.payment_complete};this.updateItem(t,a).then((function(s){e.setItem(t,a).then((function(t){var a=e.data[e.activeIndex].sales.filter((function(t){return t.payment_complete&&!t.cancelled})).reduce((function(t,e){return t+parseFloat(e.total)}),0),s=parseFloat(e.data[e.activeIndex].total);e.data[e.activeIndex].total_complete=a,e.data[e.activeIndex].ratio_complete=parseInt(a/s*100),e["statsKeys"+e.activeIndex]++,e.$buefy.toast.open({message:"Estado de pago actualizado"})}))}))},printActionList:function(){window.open("/sales/print","height=".concat(window.screen.availHeight,",width=800"))},print:function(){window.print()},toggleCancelled:function(t){var e=this;this.updateItem(t,{cancelled:t.cancelled}).then((function(t){e.$buefy.toast.open({message:"Estado de cancelación actualizado"})}))},updateItem:function(t,e){return new Promise((function(a,s){r.a.post("/sales/".concat(t._id),e).then((function(e){a(t)}))}))},setItem:function(t,e){var a=this;return new Promise((function(s,i){var n=a.data[a.activeIndex].sales.findIndex((function(e){return e._id===t._id}));Object.keys(e).map((function(a){t[a]=e[a]})),a.$set(a.data[a.activeIndex].sales,n,t),s(t)}))},saleDeliveryUpdate:function(t){var e=this;this.updateItem(t.item,t.update).then((function(a){e.setItem(t.item,t.update).then((function(t){e.$buefy.toast.open({message:"Código de entrega actualizado"})}))})),this.isSaleDeliveryBoxActive=!1},showItemDelivery:function(t){this.item=t,this.isSaleDeliveryBoxActive=!0},saleDeliveryCancel:function(){this.isSaleDeliveryBoxActive=!1},saleUpdate:function(t){var e=this;this.updateItem(t.item,t.update).then((function(a){e.setItem(t.item,t.update).then((function(t){var a=e.data[e.activeIndex].sales.filter((function(t){return t.payment_complete&&!t.cancelled})).reduce((function(t,e){return t+e.total}),0),s=e.data[e.activeIndex].sales.filter((function(t){return!t.cancelled})).reduce((function(t,e){return t+e.total}),0);e.data[e.activeIndex].total_complete=a,e.data[e.activeIndex].ratio_complete=parseInt(a/s*100),e.data[e.activeIndex].total=s,e.statsKey++,e.$buefy.toast.open({message:"Estado de cancelación actualizado"})}))})),this.isSaleBoxActive=!1},showItem:function(t){this.item=t,this.isSaleBoxActive=!0},saleCancel:function(){this.isSaleBoxActive=!1}}},D=S,$=Object(C["a"])(D,s,i,!1,null,null,null);e["default"]=$.exports},b6bb:function(t,e,a){"use strict";var s=a("e8c8"),i=a.n(s);i.a},c20d:function(t,e,a){var s=a("da84"),i=a("58a8").trim,n=a("5899"),o=s.parseInt,c=/^[+-]?0[Xx]/,r=8!==o(n+"08")||22!==o(n+"0x16");t.exports=r?function(t,e){var a=i(String(t));return o(a,e>>>0||(c.test(a)?16:10))}:o},c740:function(t,e,a){"use strict";var s=a("23e7"),i=a("b727").findIndex,n=a("44d2"),o=a("ae40"),c="findIndex",r=!0,l=o(c);c in[]&&Array(1)[c]((function(){r=!1})),s({target:"Array",proto:!0,forced:r||!l},{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),n(c)},e25e:function(t,e,a){var s=a("23e7"),i=a("c20d");s({global:!0,forced:parseInt!=i},{parseInt:i})},e8c8:function(t,e,a){}}]);
//# sourceMappingURL=chunk-49f5e7d0.bd4848f2.js.map